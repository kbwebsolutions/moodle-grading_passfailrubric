define(["jquery","core/modal_factory"],function(a,b){var c="",d=function(){var b=a(".reusable_remark");for(i=0;i<b.length;i++){var d=a(b[i]).text(),e=a("#advancedgrading-"+c);e.val().search(d)>-1?a(b[i]).addClass("reusable_remark_selected"):a(b[i]).removeClass("reusable_remark_selected")}},e=function(b){b.on("click",function(b){if(a(b.target).is(".reusable_remark")){b.preventDefault();var d=b.target.innerHTML,e="#advancedgrading-"+c;if(e=a(e),e.val().search(d)<0){EOL="\r\n";var f=a(e).val()+EOL+d;e.val(f.trim()),a(b.target).addClass("reusable_remark_selected"),a(b.target).attr("aria-selected","true")}else a(b.target).removeClass("reusable_remark_selected"),e.val(e.val().replace(d,"").trim())}})};return{init:function(){var f=a("#create-modal");a(".add_comment").on("click",function(g){b.create({title:"Click text to add to feedback",body:a("#comment_popup")[0].innerHTML,type:b.types.DEFAULT},f).done(function(a){c=g.target.id;var b=a.getRoot();e(b),a.show(),d(b)})})}}});